<!DOCTYPE html>
<html lang=&#34;en&#34; data-theme=&#34;&#34;>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"main":["/main.cce358011c7da27efa46.css","/main.cce358011c7da27efa46.js"],"component---users-wangjianbing-project-fluttercn-dev-src-pages-index-js-8-f-8-fe8":["/component---users-wangjianbing-project-fluttercn-dev-src-pages-index-js-8-f-8-fe8.d15de7da6ae110ab3e0a.css","/component---users-wangjianbing-project-fluttercn-dev-src-pages-index-js-8-f-8-fe8.d15de7da6ae110ab3e0a.js"],"metadata---a-64-e52":["/metadata---a-64-e52.df32209107e377ad2ba2.js"],"component---theme-blog-post-pageccc-cab":[],"content---blog-2019-10-11-flutter-hybrid-explain-07-f-809":["/content---blog-2019-10-11-flutter-hybrid-explain-07-f-809.af817808ed1629a916a1.js"],"metadata---blog-2019-10-11-flutter-hybrid-explain-680-3e4":["/metadata---blog-2019-10-11-flutter-hybrid-explain-680-3e4.51a2a7478739c093e7d6.js"],"nextItem---blog-2019-10-11-flutter-hybrid-explain-883-5d4":["/nextItem---blog-2019-10-11-flutter-hybrid-explain-883-5d4.636727ecc735dfbf83ec.js"],"content---blog-2019-08-30-flutter-io-633-c2e":["/content---blog-2019-08-30-flutter-io-633-c2e.2afd21e6c6b6ff67737c.js"],"nextItem---blog-2019-08-30-flutter-io-5-a-1-61e":["/nextItem---blog-2019-08-30-flutter-io-5-a-1-61e.106c7db7d1aa7fce6d74.js"],"content---blog-2019-08-29-flutter-layout-and-paintcb-1-468":["/content---blog-2019-08-29-flutter-layout-and-paintcb-1-468.f149ae43faa6cd080d2f.js"],"nextItem---blog-2019-08-29-flutter-layout-and-paint-944-f1c":["/nextItem---blog-2019-08-29-flutter-layout-and-paint-944-f1c.d99b84ed52b2d905c27a.js"],"content---blog-2019-08-14-flutter-platform-channel-0-fe-961":["/content---blog-2019-08-14-flutter-platform-channel-0-fe-961.13cf50ad94d1289297ad.js"],"nextItem---blog-2019-08-14-flutter-platform-channel-7-ed-a0b":["/nextItem---blog-2019-08-14-flutter-platform-channel-7-ed-a0b.8d53cbcdf2edd8628647.js"],"content---blog-2019-08-11-flutter-render-309-808":["/content---blog-2019-08-11-flutter-render-309-808.c9c8af3a1b920da7c7b3.js"],"nextItem---blog-2019-08-11-flutter-renderf-90-acb":["/nextItem---blog-2019-08-11-flutter-renderf-90-acb.ee6e4c739c8154e570cd.js"],"content---blog-2019-08-09-flutter-platform-view-31-b-d5a":["/content---blog-2019-08-09-flutter-platform-view-31-b-d5a.2ad129727fd6b99df5da.js"],"nextItem---blog-2019-08-09-flutter-platform-view-09-e-95e":["/nextItem---blog-2019-08-09-flutter-platform-view-09-e-95e.e56f797c1c0d2a3a8753.js"],"content---blog-2019-07-29-flutter-image-00-f-3c9":["/content---blog-2019-07-29-flutter-image-00-f-3c9.da2416adde3a61b11cd0.js"],"nextItem---blog-2019-07-29-flutter-imagef-9-b-2cd":["/nextItem---blog-2019-07-29-flutter-imagef-9-b-2cd.fba56f256109f793d950.js"],"content---blog-2019-07-23-flutter-texte-7-f-5e3":["/content---blog-2019-07-23-flutter-texte-7-f-5e3.470f1ae10bf03f858b6e.js"],"nextItem---blog-2019-07-23-flutter-text-491-9fd":["/nextItem---blog-2019-07-23-flutter-text-491-9fd.9fb532a04c79d1240121.js"],"content---blog-2019-07-16-dart-basis-4571-109":["/content---blog-2019-07-16-dart-basis-4571-109.85d1b2f22be1a4c1198c.js"],"nextItem---blog-2019-07-16-dart-basis-4-d-07-edf":["/nextItem---blog-2019-07-16-dart-basis-4-d-07-edf.aefac2eaff13f80991f6.js"],"content---blog-2019-07-15-dart-basis-3-de-0-611":["/content---blog-2019-07-15-dart-basis-3-de-0-611.be4e2d830236c8fd2c68.js"],"nextItem---blog-2019-07-15-dart-basis-3-c-72-cb6":["/nextItem---blog-2019-07-15-dart-basis-3-c-72-cb6.5a0273e64af8191cbc7c.js"],"content---blog-2019-07-14-dart-basis-2401-3b5":["/content---blog-2019-07-14-dart-basis-2401-3b5.212fc928f85603bfd0cb.js"],"nextItem---blog-2019-07-14-dart-basis-2074-310":["/nextItem---blog-2019-07-14-dart-basis-2074-310.9b6a0876f6496f86c46a.js"],"content---blog-2019-07-13-dart-basis-11-d-6-128":["/content---blog-2019-07-13-dart-basis-11-d-6-128.4e92e8450593f52a9493.js"],"nextItem---blog-2019-07-13-dart-basis-1220-dd2":["/nextItem---blog-2019-07-13-dart-basis-1220-dd2.8fe561164e8328d2e9a3.js"],"content---blog-2019-07-12-flutter-widget-videosc-9-f-72c":["/content---blog-2019-07-12-flutter-widget-videosc-9-f-72c.6ab14c5cda6b0a173503.js"],"component---theme-doc-legacy-page-9-e-7-ca5":[],"docsMetadata---docs-219-f23":["/docsMetadata---docs-219-f23.ee7c76f4a45bf0253546.js"],"component---theme-doc-legacy-item-031-769":[],"content---docs-doc-1-d-42-e1f":["/content---docs-doc-1-d-42-e1f.9801686b8d41814ed576.js"],"metadata---docs-doc-187-a-aee":["/metadata---docs-doc-187-a-aee.b48738b9271195f0fe54.js"],"content---docs-doc-2-c-2-e-e91":["/content---docs-doc-2-c-2-e-e91.14c1c7e2150ed6ded4a3.js"],"metadata---docs-doc-2-dc-7-408":["/metadata---docs-doc-2-dc-7-408.83174d4cd91b3ace2a13.js"],"content---docs-doc-3688-ea2":["/content---docs-doc-3688-ea2.217cb3a99c6bd5dafc23.js"],"metadata---docs-doc-31-f-9-209":["/metadata---docs-doc-31-f-9-209.24a0dc2a33675a78ff58.js"],"content---docs-mdx-442-733":["/content---docs-mdx-442-733.b34ee68d263a3e07a645.js"],"metadata---docs-mdxb-5-a-c9d":["/metadata---docs-mdxb-5-a-c9d.2f67a5d332f7a4a16edf.js"],"component---theme-blog-list-pagea-6-a-7ba":[],"content---blog-16-d-aca":["/content---blog-16-d-aca.651e5449446a0b8ec69e.js"],"content---blogf-34-924":["/content---blogf-34-924.2e2f108c63393055ecfb.js"],"content---bloga-3-e-946":["/content---bloga-3-e-946.0929cdd848eca32089b9.js"],"content---blogdb-9-70f":["/content---blogdb-9-70f.b9c066a7a24446e8c731.js"],"content---blog-76-b-6a5":["/content---blog-76-b-6a5.7ddf003aed75b810096a.js"],"content---blog-33-c-c1d":["/content---blog-33-c-c1d.1028a6163b4abe04512b.js"],"content---blog-7-a-4-f34":["/content---blog-7-a-4-f34.bc96f98191bfb00c4ff5.js"],"content---bloge-13-1a7":["/content---bloge-13-1a7.8b8b3d4666c8be34eef6.js"],"content---blog-32-d-e46":["/content---blog-32-d-e46.17365dce2096fb69d5da.js"],"content---blog-093-e63":["/content---blog-093-e63.af8e15d37baf5a317c96.js"],"metadata---blog-2-db-770":["/metadata---blog-2-db-770.be34e74057b4bf7d13ec.js"],"content---blog-page-2-ba-9-606":["/content---blog-page-2-ba-9-606.e496c76e95df4b6f81db.js"],"content---blog-page-2021-96f":["/content---blog-page-2021-96f.294bc0d83c44e54f6cfb.js"],"content---blog-page-2350-fca":["/content---blog-page-2350-fca.22f304d672d61dd4a467.js"],"metadata---blog-page-29-ac-584":["/metadata---blog-page-29-ac-584.a034ad86d46157e071b6.js"],"component---theme-blog-tags-posts-page-687-b6c":[],"metadata---blog-tags-flutter-320-292":["/metadata---blog-tags-flutter-320-292.aeb6dde98cca69865101.js"],"metadata---blog-tags-hybrid-416-b77":["/metadata---blog-tags-hybrid-416-b77.56bf4c8ca5dc99bd91e0.js"],"metadata---blog-tags-widget-713-3a7":["/metadata---blog-tags-widget-713-3a7.c417e05424302394e71e.js"],"metadata---blog-tags-io-20-a-983":["/metadata---blog-tags-io-20-a-983.b838a1a3e27d21298abe.js"],"metadata---blog-tags-dartcbf-34e":["/metadata---blog-tags-dartcbf-34e.7b7d4eac74898bd72c2f.js"],"metadata---blog-tags-platform-viewf-71-08e":["/metadata---blog-tags-platform-viewf-71-08e.fd81e1a2e0eb5ccbb23e.js"],"metadata---blog-tags-basicc-82-d21":["/metadata---blog-tags-basicc-82-d21.2f08dce8a001b63ce91c.js"],"metadata---blog-tags-video-577-edd":["/metadata---blog-tags-video-577-edd.16e822ea9a534446f0e2.js"],"component---theme-blog-tags-list-page-01-a-d0b":[],"tags---blog-tags-958-e2f":["/tags---blog-tags-958-e2f.8245beaac7c1bd1ca442.js"]};/*]]>*/</script>

<title data-react-helmet="true">Flutter 混合栈复用原理</title>

<meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" name="viewport" content="width=device-width"/><meta data-react-helmet="true" property="og:title" content="Flutter 混合栈复用原理"/><meta data-react-helmet="true" name="description" content="本文将以 Android 视角，来扒一扒 Flutter 混合栈的前世今生。其实也就是从 1.0 正式发布到现在 1.9 版本的一些变更。"/><meta data-react-helmet="true" property="og:description" content="本文将以 Android 视角，来扒一扒 Flutter 混合栈的前世今生。其实也就是从 1.0 正式发布到现在 1.9 版本的一些变更。"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/>

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"/>


<link rel="stylesheet" type="text/css" href="/main.cce358011c7da27efa46.css" />

<link rel="stylesheet" type="text/css" href="/component---users-wangjianbing-project-fluttercn-dev-src-pages-index-js-8-f-8-fe8.d15de7da6ae110ab3e0a.css" />

<link rel="stylesheet" type="text/css" href="/docusaurus.994cfcaae72bb70246f9.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/favicon.png" alt="Flutter-Fans Logo"/><strong>Flutter-Fans</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" label="Blog" position="left" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_1gtMWLzW"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_16vChPFo moon_1N64xB5S"></span></div><div class="react-toggle-track-x"><span class="toggle_16vChPFo sun_3CZP6R61"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar__sidebar__backdrop"></div><div class="navbar__sidebar"><div class="navbar__sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/favicon.png" alt="Flutter-Fans Logo"/><strong>Flutter-Fans</strong></a></div><div class="navbar__sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" label="Blog" position="left" href="/blog">Blog</a></li></ul></div></div></div></nav><div class="container margin-vert--xl"><div class="row"><div class="col col--8 col--offset-2"><div><header><h1 class="margin-bottom--xs"><a aria-current="page" class="active" href="/blog/2019/10/11/flutter-hybrid-explain">Flutter 混合栈复用原理</a></h1><div class="margin-bottom--sm"><small>October<!-- --> <!-- -->11<!-- -->, <!-- -->2019</small></div><div class="avatar margin-bottom--md"><a class="avatar__photo-link" href="https://github.com/loosaSH" target="_blank" rel="noreferrer noopener"><img class="avatar__photo" src="https://p5.ssl.qhimg.com/t01b6580ec3d65d7b7f.png" alt="loosaSH"/></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/loosaSH" target="_blank" rel="noreferrer noopener">loosaSH</a></h4><small class="avatar__subtitle">A flutter fans</small></div></div></header><article class="markdown"><p>本文将以 Android 视角，来扒一扒 Flutter 混合栈的前世今生。其实也就是从 1.0 正式发布到现在 1.9 版本的一些变更。</p><p>本文将会从以下几个方面来分析：</p><ul><li>什么是 Flutter 混合栈</li><li>为什么会产生问题</li><li>处理混合栈的相关框架</li><li>官方的处理方案</li></ul><h2><a aria-hidden="true" class="anchor" id="一、什么是混合栈"></a><a aria-hidden="true" class="hash-link" href="#一、什么是混合栈">#</a>一、什么是混合栈</h2><p>一个新的技术的兴起，必然是一步一步向前的，Flutter 在成熟的 Android、iOS 的大环境下的生存，必要与 native 融合。</p><p>一些成熟的 APP ，如果想使用 Flutter 技术，必然不会完全使用 Flutter 重写，那样的成本太高，所以 Native + Flutter 的项目就出现了，Native 页面与 Flutter 页面共存，甚至交替呈现在用户手机上。</p><p>那什么是混合栈呢？</p><p>相信你已经有了答案，下面我们用 Android 的视角来重新审视一下混合栈。</p><p><img src="http://p0.qhimg.com/t0196b0247a89e11c1e.jpg"/></p><p>我们使用 flutter boost 框架提供的 demo 来看一下混合栈的效果（debug包）</p><p><img src="http://p0.qhimg.com/t01fa492e6dc759628b.gif"/></p><h2><a aria-hidden="true" class="anchor" id="二、为什么会产生问题"></a><a aria-hidden="true" class="hash-link" href="#二、为什么会产生问题">#</a>二、为什么会产生问题</h2><p>知道了混合栈问题，接下来我们要考虑为什么会出现这样的问题。</p><h3><a aria-hidden="true" class="anchor" id="目标是什么"></a><a aria-hidden="true" class="hash-link" href="#目标是什么">#</a>目标是什么</h3><p>现状是一个 Activity 中存在多个 Flutter Page，我们想要的是 Flutter Page 与 Android Activity 可以一一对应，这样便可以简单的将两个页面栈合并成一个栈，并且在性能上不会产生影响，这就是我们处理混合栈的目标。</p><p>如上图混合栈所示，Android 中以 FlutterView 承载 Flutter 的展示，默认情况下不同 FlutterView 创建了不同的 engine。如果一个 Flutter Page 对应一个 Activity， 这就导致了资源的多次重复创建和内存的不共享。</p><p>如果极端情况下，Native =&gt; Flutter =&gt; Native =&gt; … =&gt; Native =&gt; Flutter 会是什么情况呢？后果不堪设想，当然，可以从业务上避免这样的问题，但是作为框架的制定者，必须要考虑到这样的问题。</p><p>接下来我们看如何解决问题。需要从原理入手，需要阅读源码</p><h3><a aria-hidden="true" class="anchor" id="flutter-架构图"></a><a aria-hidden="true" class="hash-link" href="#flutter-架构图">#</a>Flutter 架构图</h3><p>从最经典的 Flutter 架构图入手</p><p><img src="https://raw.githubusercontent.com/flutter/engine/master/docs/flutter_overview.svg?sanitize=true" alt="Flutter System Overview"/></p><p>从图中可以看到 3 层架构，每层提供了不同的能力</p><ul><li>Framework：这一层提供了Flutter 的常用控件，也提供了用于绘制的一些准备工作，详见<a href="https://mp.weixin.qq.com/s/ncViI0KGikPUIZ7BlEHGOA">Flutter 从加载到显示</a></li><li>Engine：这一层提供了Flutter的2D图形渲染库Skia和用于垃圾收集的面向对象语言的 Dart VM，并将它们托管在Shell中。这里也提供了 Platform Channels 等与 Native 交互的 API。可以参考这篇文章<a href="https://github.com/flutter/flutter/wiki/The-Engine-architecture">The Engine architecture</a></li><li>Embedder：这一层提供了不同平台的嵌入 API 如 Andorid、iOS。使得 Flutter 可以运行在不同的嵌入式平台。这里有一片关于自定义 Embedder 的文章<a href="https://github.com/flutter/flutter/wiki/Custom-Flutter-Engine-Embedders">Custom Flutter Engine Embedders</a></li></ul><blockquote><p>Flutter 从加载到显示<br/><a href="https://mp.weixin.qq.com/s/ncViI0KGikPUIZ7BlEHGOA">https://mp.weixin.qq.com/s/ncViI0KGikPUIZ7BlEHGOA</a></p><p>The Engine architecture<br/><a href="https://github.com/flutter/flutter/wiki/The-Engine-architecture">https://github.com/flutter/flutter/wiki/The-Engine-architecture</a></p><p>Custom Flutter Engine Embedders<br/><a href="https://github.com/flutter/flutter/wiki/Custom-Flutter-Engine-Embedders">https://github.com/flutter/flutter/wiki/Custom-Flutter-Engine-Embedders</a></p></blockquote><h3><a aria-hidden="true" class="anchor" id="在-android-中的-flutter"></a><a aria-hidden="true" class="hash-link" href="#在-android-中的-flutter">#</a>在 Android 中的 Flutter</h3><p>我们看一下创建 Flutter 项目中自动生成的 Android 工程，内部使用的是 io.flutter.app 包内的 FlutterActivity，暂且不讨论 io.flutter.embedding.android 包相关内容，后面会分析。</p><p>在 Android 中使用 Flutter 是这样的</p><p><img src="http://p0.qhimg.com/t012e1f4c21882aeeb2.png" alt="io.flutter.app.Activity内容"/></p><p>如上图所示，图中罗列了一些类，这里讲解一下</p><ul><li>FlutterView：Android 中用于展示 Flutter 页面的控件，一个 FlutterView 中可以展示多个 Flutter Widget，官方的注释是：<em>&quot;An Android View containing a Flutter app&quot;</em>。内部包含了 FlutterNativeView。</li><li>FlutterNativeView：每个 FlutterView 中包含一个FlutterNativeView，该类的主要作用是 Android 与 Flutter 之间的通信，保持生命周期与 Activity 及 FlutterView 同步。内部包含了 DartExecutor。</li><li>DartExecutor：根据名称我们可以了解，这个类就是 Dart VM 相关处理 Java 与 C/C++ 的调用。官方的注释是：<em>&quot;Configures, bootstraps, and starts executing Dart code&quot;</em>。</li></ul><p>其实 Flutter 的运行机制就是这样的，Flutter 由 FlutterView 呈现。每一个 FlutterView，会对应的创建一个 FlutterNativeView，创建一个 Dart VM。而不同 FlutterView 内部的 Dart 代码内存无法共享。</p><h3><a aria-hidden="true" class="anchor" id="源码阅读"></a><a aria-hidden="true" class="hash-link" href="#源码阅读">#</a>源码阅读</h3><p>建议读者阅读一下代码</p><blockquote><p>io.flutter.app.FlutterActivit<br/>Io.flutter.app.FlutterActivityDelegate<br/>io.flutter.view.FlutterMain<br/>io.flutter.view.FlutterView<br/>io.flutter.view.FlutterNativeView<br/>io.flutter.embedding.engine.dart.DartExecutor<br/>io.flutter.embedding.engine.FlutterJNI<br/></p></blockquote><h3><a aria-hidden="true" class="anchor" id="我们能做什么"></a><a aria-hidden="true" class="hash-link" href="#我们能做什么">#</a>我们能做什么</h3><p>通过上面的介绍，应该依然了解 Flutter 在 Android 上的运行机制，如果阅读了源码应该有更深的印象。在这样的运行机制中，我们能做什么呢？其实 Flutter Boost 框架给了我们解决的思路，但是这里我还是希望读者能自己来想想，如果是你自己来实现，该怎么做呢？</p><h2><a aria-hidden="true" class="anchor" id="三、混合栈处理框架"></a><a aria-hidden="true" class="hash-link" href="#三、混合栈处理框架">#</a>三、混合栈处理框架</h2><p>来看看社区为我们提供的方案吧。</p><p>网上的文章很多，在文章最后提供一些链接，有兴趣的读者可以都看一下。这里仅以 Flutter Boost 为例，来分析一下。</p><p>Flutter Boost 的处理方案可以分成两个版本，使用了两种方案，可以作为混合栈方案的两种代表思路。</p><h3><a aria-hidden="true" class="anchor" id="flutter-boost-004版本"></a><a aria-hidden="true" class="hash-link" href="#flutter-boost-004版本">#</a>Flutter Boost 0.0.4+版本</h3><blockquote><p>alibaba/flutter_boost 0.0.420 <br/><a href="https://github.com/alibaba/flutter_boost/releases/tag/0.0.420">https://github.com/alibaba/flutter_boost/releases/tag/0.0.420</a></p></blockquote><p><strong>FlutterView 复用方案</strong></p><p>框架中从 FlutterActivityDelegate#onCreate 方法入手，重写创建 FlutterView 的流程，复用 FlutterView 来实现。</p><p>我们先来看一下这个版本的接入方式，在 Application 中初始化</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterBoostPlugin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">IPlatform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">          </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">/**</span></div><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">         * 获取应用入口的Activity,这个Activity在应用交互期间应该是一直在栈底的</span></div><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">         * 提供给框架内部，后续创建FlutterView用</span></div><div class="token-line" style="color:#d6deeb"><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">         */</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Activity</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getMainActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">MainActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sRef </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">MainActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sRef</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>我们来看一下 FlutterActivityDelegate#onCreate 是如何处理的。</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterActivityDelegate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java    </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">Bundle</span><span class="token plain"> savedInstanceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 获取 flutterView</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        flutterView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> viewFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">activity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 为空则创建，否则直接使用</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">flutterView </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 创建 FlutterView 的同时，创建 FlutterNative、DartExecutor</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterNativeView</span><span class="token plain"> nativeView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> viewFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterNativeView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            flutterView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">activity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> nativeView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            flutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setLayoutParams</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">matchParent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            activity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setContentView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">flutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            launchView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createLaunchView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">launchView </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">addLaunchView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>createFlutterView 的实现是在 FlutterActivity 中的。</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterView</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">Context</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>而 Flutter Boost 框架重写了 createFlutterView 方法</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># </span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostFlutterActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterView</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">Context</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterBoostPlugin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">viewProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>真正返回的是这里构造的</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterViewProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostFlutterView</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">IFlutterViewContainer</span><span class="token plain"> container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 在 Application 中提供的 mPlatform，将缓存的 Activity 提供给这里</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 139)">Activity</span><span class="token plain"> activity </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> mPlatform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getMainActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">activity </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 139)">Debuger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(173, 219, 103)">&quot;create Flutter View not with MainActivity&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            activity </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 如果为 null 则创建然后缓存，有值则直接使用</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mFlutterView </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// BoostFlutterView 继承自 FlutterView</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            mFlutterView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">activity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterNativeView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> mFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>这样就复用了 FlutterView。</p><p>复用 FlutterView 需要在 Activity 切换的时候进行 view 的 attach、detach，该版本使用了截图方案。</p><h3><a aria-hidden="true" class="anchor" id="flutter-boost-015版本"></a><a aria-hidden="true" class="hash-link" href="#flutter-boost-015版本">#</a>Flutter Boost 0.1.5+版本</h3><p><strong>FlutterEngine 复用</strong></p><p>从接入方式来看，在 Application 中初始化，提供了一个回调方法，提供 BoostFlutterEngine 即是 FlutterEngine 实例。</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterBoost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Platform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">IFlutterEngineProvider</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">engineProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostEngineProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostFlutterEngine</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">Context</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostFlutterEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">DartExecutor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 139)">DartEntrypoint</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                            context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getResources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getAssets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                            </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterMain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">findAppBundlePath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                            </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;main&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(173, 219, 103)">&quot;/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>在看 BoostFlutterActivity 实现</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">protected</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">Bundle</span><span class="token plain"> savedInstanceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">onCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">savedInstanceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        mFlutterEngine </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        mFlutterView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mFlutterEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">setContentView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">protected</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostFlutterEngine</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterBoost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">singleton</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">engineProvider</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">provideEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>真正返回的是这里构造的</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># com</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">idlefish</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">flutterboost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostEngineProvider</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">public</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">BoostFlutterEngine</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">provideEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">Context</span><span class="token plain"> context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 139)">Utils</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">assertCallOnMainThread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mEngine </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterShellArgs</span><span class="token plain"> flutterShellArgs </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterShellArgs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">String</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterMain</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">ensureInitializationComplete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                    context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getApplicationContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> flutterShellArgs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">toArray</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 这里调用的方法就是初始化时重写内容</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            mEngine </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getApplicationContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">final</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">IStateListener</span><span class="token plain"> stateListener </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterBoost</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">mStateListener</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token keyword" style="color:rgb(127, 219, 202)">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">stateListener </span><span class="token operator" style="color:rgb(127, 219, 202)">!=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">                stateListener</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">onEngineCreated</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">mEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> mEngine</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>该版本的处理方式与 io.flutter.embedding 包中处理方式基本相同，使用了 flutter.jar 中的 FlutterSurfaceView 和 FlutterTextureView 来最终的展示 Flutter 界面。接下来我们看看 Flutter 官方为我们提供的方式。</p><h2><a aria-hidden="true" class="anchor" id="官方提供的方式"></a><a aria-hidden="true" class="hash-link" href="#官方提供的方式">#</a>官方提供的方式</h2><blockquote><p>Experimental: Adding Flutter to Android<br/><a href="https://github.com/flutter/flutter/wiki/Experimental:-Adding-Flutter-to-Android">https://github.com/flutter/flutter/wiki/Experimental:-Adding-Flutter-to-Android</a></p></blockquote><p>通过文档我们就可以知道，该方式和 Flutter 项目自动生成的 Android 工程不同，使用的大多为 io.flutter.embedding 包中的内容，并且提供了使用缓存的 FlutterEngine 的方式。使用了 FlutterEngineCache 类进行对 FlutterEngine 的 key-value 缓存。</p><p>在 flutter.jar 中可以看到，共存了两个 FlutterActivity、FlutterView 等。</p><p>FlutterActivity</p><blockquote><p>io.flutter.app.FlutterActivity<br/>io.flutter.embedding.FlutterActivity </p></blockquote><p>FlutterView</p><blockquote><p>io.flutter.view.FlutterView<br/>io.flutter.embedding.FlutterView</p></blockquote><p>这里简单介绍一下</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">flutter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embedding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java</span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Override</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">protected</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Nullable</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Bundle</span><span class="token plain"> savedInstanceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">super</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">onCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">savedInstanceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    delegate </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterActivityAndFragmentDelegate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 创建 Flutter</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 提供 FlutterEngine 并绑定到 Activity、创建并配置 PlatformPlugin、</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    delegate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">onAttach</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="color:rgb(127, 219, 202)">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 创建 Flutter 的 View 并绑定到 Activity</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">setContentView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@NonNull</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token keyword" style="color:rgb(127, 219, 202)">private</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">View</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">createFlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> delegate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">onCreateView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">/* inflater */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">/* container */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">null</span><span class="token plain"> </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">/* savedInstanceState */</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>加载到 Activity 上的 View 是如何创建的</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token plain"># io</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">flutter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">embedding</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">android</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterActivityAndFragmentDelegate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">java  </span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@NonNull</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token class-name" style="color:rgb(255, 203, 139)">View</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">onCreateView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 139)">LayoutInflater</span><span class="token plain"> inflater</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Nullable</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">ViewGroup</span><span class="token plain"> container</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token annotation punctuation" style="color:rgb(199, 146, 234)">@Nullable</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">Bundle</span><span class="token plain"> savedInstanceState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 创建了一个 FlutterView</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    flutterView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getActivity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getRenderMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getTransparencyMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 创建了一个 FlutterSplashView，包裹了一个 FlutterView 的View</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    flutterSplashView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterSplashView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 在 FlutterView 展示第一帧之前，先展示提供的 splashScreen</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    flutterSplashView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">displayFlutterViewWithSplash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">flutterView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">provideSplashScreen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">return</span><span class="token plain"> flutterSplashView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>看一下 FlutterView 是如何实现的</p><pre class="mdxCodeBlock_iHAB0Zg7"><div class="codeBlockWrapper_2QGZbNRm"><pre class="prism-code language-java codeBlock_19pQyIiL" style="color:#d6deeb;background-color:#011627"><div class="token-line" style="color:#d6deeb"><span class="token keyword" style="color:rgb(127, 219, 202)">private</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token comment" style="color:rgb(99, 119, 119);font-style:italic">// 根据 renderMode 模式来选择使用 SurfaceView/TextureView，解决了 SurfaceView 对动画支持差的诟病</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token keyword" style="color:rgb(127, 219, 202)">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">renderMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token keyword" style="color:rgb(127, 219, 202)">case</span><span class="token plain"> surface</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterSurfaceView</span><span class="token plain"> flutterSurfaceView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterSurfaceView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">getContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> transparencyMode </span><span class="token operator" style="color:rgb(127, 219, 202)">==</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">TransparencyMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">transparent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        renderSurface </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> flutterSurfaceView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">addView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">flutterSurfaceView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">      </span><span class="token keyword" style="color:rgb(127, 219, 202)">case</span><span class="token plain"> texture</span><span class="token operator" style="color:rgb(127, 219, 202)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterTextureView</span><span class="token plain"> flutterTextureView </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(127, 219, 202)">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 139)">FlutterTextureView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">getContext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        renderSurface </span><span class="token operator" style="color:rgb(127, 219, 202)">=</span><span class="token plain"> flutterTextureView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">addView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">flutterTextureView</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">        </span><span class="token keyword" style="color:rgb(127, 219, 202)">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">setFocusable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">setFocusableInTouchMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#d6deeb"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYjXM7E">Copy</button></div></pre><p>大致的流程就是这样的。</p><h2><a aria-hidden="true" class="anchor" id="小结"></a><a aria-hidden="true" class="hash-link" href="#小结">#</a>小结</h2><p>Flutter 的混合栈处理在这一年多内，也有了很大的发展，从整个发展历程来梳理，可能对混合栈的方案有更深的理解。最后附上整理的混合栈相关文章</p><p>Flutter 混合栈处理相关文章：</p><blockquote><p>码上用它开始 Flutter 混合开发——FlutterBoos<br/><a href="https://my.oschina.net/yunqi/blog/3038039">https://my.oschina.net/yunqi/blog/3038039</a></p><p>Flutter 新锐专家之路：混合开发片<br/><a href="https://juejin.im/post/5b764acb51882532dc1812b1">https://juejin.im/post/5b764acb51882532dc1812b1</a></p><p>微店的 Flutter 混合栈管理技术实践<br/><a href="https://juejin.im/post/5c419c07f265da616f703aa1">https://juejin.im/post/5c419c07f265da616f703aa1</a></p><p>Flutter 实现原理及在马蜂窝的跨平台开发事件<br/><a href="https://juejin.im/post/5d37b328518825453b6057b2">https://juejin.im/post/5d37b328518825453b6057b2</a></p><p>让 Flutter 真正支持 View级别的混合开发<br/><a href="https://mp.weixin.qq.com/s?__biz=MzI1MzYzMjE0MQ==&amp;mid=2247485002&amp;idx=1&amp;sn=42d8683ec7777dbd1737c431edef1716&amp;chksm=e9d0cda8dea744bebeb19e2cb025bab79dc38fae568f6a3e2b00b88514da88b7928c03ecbf56&amp;sessionid=1570763650&amp;scene=126&amp;subscene=0&amp;clicktime=1570763683&amp;ascene=3&amp;devicetype=android-28&amp;version=27000536&amp;nettype=WIFI&amp;abtest_cookie=BAABAAoACwASABMABAAjlx4AVpkeAL2ZHgD4mR4AAAA%3D&amp;lang=zh_CN&amp;pass_ticket=dcVAZN9GBaJFUZApeVBRXeX9nT7JeHZRM3Jf%2BgtUJVS0idNTtObtYwh2dlc84G3D&amp;wx_header=1">https://mp.weixin.qq.com/s?__biz=MzI1MzYzMjE0MQ==&amp;mid=2247485002&amp;idx=1&amp;sn=42d8683ec7777dbd1737c431edef1716&amp;chksm=e9d0cda8dea744bebeb19e2cb025bab79dc38fae568f6a3e2b00b88514da88b7928c03ecbf56&amp;sessionid=1570763650&amp;scene=126&amp;subscene=0&amp;clicktime=1570763683&amp;ascene=3&amp;devicetype=android-28&amp;version=27000536&amp;nettype=WIFI&amp;abtest_cookie=BAABAAoACwASABMABAAjlx4AVpkeAL2ZHgD4mR4AAAA%3D&amp;lang=zh_CN&amp;pass_ticket=dcVAZN9GBaJFUZApeVBRXeX9nT7JeHZRM3Jf%2BgtUJVS0idNTtObtYwh2dlc84G3D&amp;wx_header=1</a></p></blockquote></article><div class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog/tags/flutter">flutter</a><a class="margin-horiz--sm" href="/blog/tags/hybrid">hybrid</a></div><div class="col text--right"></div></div></div><div class="margin-vert--xl"><nav class="pagination-nav"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2019/08/30/flutter-io"><h5 class="pagination-nav__link--sublabel">Next Post</h5><h4 class="pagination-nav__link--label">Flutter之请求<!-- --> »</h4></a></div></nav></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center">Copyright © 2019 Flutter-Fans. Built with Docusaurus.</div></div></footer>
</div>

<script type="text/javascript" src="/runtime~main.1e8341a32f645e7b2fe7.js"></script>

<script type="text/javascript" src="/main.cce358011c7da27efa46.js"></script>

<script type="text/javascript" src="/vendors.20ec14ef348a891cbe0a.js"></script>

<script type="text/javascript" src="/react-helmet.7bf7b3bdf6ce28021eb7.js"></script>

<script type="text/javascript" src="/prism-react-renderer.e76e6ef8997e15114c2f.js"></script>

<script type="text/javascript" src="/component---users-wangjianbing-project-fluttercn-dev-src-pages-index-js-8-f-8-fe8.d15de7da6ae110ab3e0a.js"></script>

<script type="text/javascript" src="/docusaurus.994cfcaae72bb70246f9.js"></script>

<script type="text/javascript" src="/content---blog-2019-10-11-flutter-hybrid-explain-07-f-809.af817808ed1629a916a1.js"></script>

<script type="text/javascript" src="/metadata---blog-2019-10-11-flutter-hybrid-explain-680-3e4.51a2a7478739c093e7d6.js"></script>

<script type="text/javascript" src="/nextItem---blog-2019-10-11-flutter-hybrid-explain-883-5d4.636727ecc735dfbf83ec.js"></script>

</body>
</html>